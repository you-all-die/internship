<!-- Роман Каравашкин-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/fomain :: common_header(~{::title},_,~{::script})">
    <meta charset="UTF-8">
    <meta name="author" content="Роман Каравашкин">
    <title th:text="${product.name}"></title>
    <script th:src="@{/js/addToCart.js}"></script>

</head>
<body>
<div th:replace="/common/main :: header"></div>

<div th:each="pr: ${product}" class="ui container">
    <!-- Дерево предков категорий -->
    <div class="row">
        <div class="ui breadcrumb">
            <a th:href="@{/product}" class="section">Каталог</a>
            <th:block th:each="category : ${breadcrumb}">
                <i class="right angle icon divider"></i>
                <a th:href="@{/product?categoryId=} + ${category.id}" class="section" th:text="${category.name}">Child</a>
            </th:block>
        </div>
    </div>

    <!-- Название и код товара -->
    <h1 class="ui header " th:text="${product.name}"></h1>
    <h10 class="ui header " th:text="'Код товара: ' + ${product.id}"></h10><br><br>

    <div class="ui two column grid">

        <!--Блок с изображением-->
        <div class="column">
            <div class="ui raised segment">
                <div class="ui red ribbon label"><p>ТОВАР МЕСЯЦА</p></div>
                <div th:if="${pr.picture == null or pr.picture.isEmpty()}">
                    <img class="ui fluid image" th:src="'/img/' + ${@environment.getProperty('default.image')}">
                </div>
                <div th:unless="${pr.picture == null or pr.picture.isEmpty()}">
                    <img class="ui fluid image" th:src="'/img/' + ${pr.id} + '/product.' + ${pr.picture}">
                </div>
            </div>
        </div>

        <!--Блок c описанием-->
        <div class="column">
            <div class="ui segment">
                <div class="ui two column grid">
                    <div class="column">
                        <p><b>Цена:</b></p>
                        <div>
                            <h2><span class="ui header" th:text="${product?.price}"></span><i class="ruble sign icon"></i></h2>
                        </div>
                        <div class="ui teal tag label" th:if="${product.status.id == 1}">В наличии</div><br>
                        <div class="ui red tag label" th:if="${product.status.id == 2}">Нет в наличии</div><br><br>
                        <button class="ui yellow button" th:onclick="|testOne(${product.id})|" th:if="${product.status.id == 1}">
                            <i class="shopping cart icon" ></i>  Добавить в корзину
                        </button>
                    </div>
                    <!--Предоставляемые сервисы-->
                    <div class="column"><br>
                        <div class="item">
                            <h4><i class="shipping fast icon"></i>  Быстрая доставка</h4>
                        </div><br>
                        <div class="item">
                            <h4><i class="wrench icon"></i>  Гарантия 24месяца</h4>
                        </div><br>
                        <div class="item">
                            <h4><i class="credit card outline icon"></i>  Visa, MasterCard, МИР</h4>
                        </div><br>
                        <div class="item">
                            <h4><i class="credit card icon"></i>  Покупка в кредит</h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ui segment">
                <h3 class="ui header">Описание товара</h3>
                <p th:text="${product.description}"></p>
            </div>
        </div>
    </div>
</div>

<!--Комментарии к товару-->
<div  class="ui main container">
    <h3><span>Комментарии </span><span th:text="'(' + ${feedbacksList.totalFeedbacks} + ')'"
                                       th:if="${feedbacksList.totalFeedbacks != null}"></span></h3><hr>
    <div class="ui container" th:if="${#arrays.isEmpty(feedbacksList.feedbacks)}">
        <br><h4>Ни одного комментария не найдено... Будь первым.</h4><br>
    </div>
    <!--Блок отображения существующих комментариев к товару-->
    <div class="ui comments" th:unless="${#arrays.isEmpty(feedbacksList.feedbacks)}">
        <div th:each="f:${feedbacksList.feedbacks}" class="comment">
            <div class="avatar">
                <img src="/img/comment_icon.png">
            </div>
            <div class="content">
                <div class="author"><label th:text="${f.authorName}"></label></div>
                <div class="metadata">
                    <span class="date" th:text="'Дата: ' + ${f.datePublication.toString().substring(0, 10)}"></span>
                </div>
                <div class="text" th:text="${f.feedbackText}"></div><br><hr>
                <div class="actions" th:if=
                        "${(customerId == f.authorId and customerId != null) or
                           (aCustomerId == f.authorId and aCustomerId != null)}">
                    <form th:action="@{'/product/' + ${product.id} + '/deleteFeedback'}" method="post">
                        <button type="submit" name="feedbackId" th:value="${f.id}" class="circular ui icon button">
                            <i class="trash alternate icon"></i>
                        </button>
                        <span class="reply">  Вы можете удалить свой отзыв.</span>
                    </form>
                </div><br>
            </div>
        </div>
    </div><br><hr>

    <!--Пагинатор для комментариев-->
    <div th:replace="/common/paginator :: widget (${feedbacksList.pageNumber}, ${totalPage})"></div><br><br>

    <!--Форма добавление нового комментария-->
    <div class="ui comments">
        <form class="ui reply form" th:action="@{'/product/' + ${product.id} + '/addNewComment'}" method="post">
            <h5 class="ui dividing header">Добавить новый комментарий</h5>
            <div class="field" th:if="${customerId == null}">
                <label>Ваше имя:</label>
                <input class="" name="customerName"  type="text" placeholder="Введите Ваше имя" required/>
            </div>
            <div class="field">
                <label>Текст комментария:</label>
                <textarea name="textComment" required maxlength="500"></textarea>
            </div>
            <button class="ui button" type="submit"><i class="icon edit"></i> Добавить</button>
        </form>
    </div>


</div>

<footer th:replace="common/main::footer"></footer>

</body>
</html>
